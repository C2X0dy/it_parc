<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Vue Kanban pour le tableau de bord -->
    <record id="view_it_dashboard_kanban" model="ir.ui.view">
        <field name="name">it.dashboard.kanban</field>
        <field name="model">it.dashboard</field>
        <field name="arch" type="xml">
            <kanban class="o_it_dashboard" create="0">
                <templates>
                    <t t-name="kanban-box">
                        <div class="modern-dashboard">
                            <!-- Barre d'action avec boutons -->
                            <div class="action-bar">
                                <button class="btn-modern btn-primary">Tout voir</button>
                                <button class="btn-modern btn-outline">Exporter</button>
                            </div>
                            
                            <!-- Cartes KPI -->
                            <div class="kpi-cards-container">
                                <!-- Équipements -->
                                <div class="kpi-card bg-green">
                                    <div class="kpi-icon">
                                        <i class="fa fa-laptop-code"></i>
                                    </div>
                                    <div class="kpi-info">
                                        <div class="kpi-title">Total Équipements</div>
                                        <div class="kpi-value"><field name="total_assets"/>.<span class="decimal">00</span></div>
                                    </div>
                                    <div class="kpi-badge">
                                        <i class="fa fa-ellipsis-v"></i>
                                    </div>
                                </div>
                                
                                <!-- Contrats -->
                                <div class="kpi-card bg-blue">
                                    <div class="kpi-icon">
                                        <i class="fa fa-file-contract"></i>
                                    </div>
                                    <div class="kpi-info">
                                        <div class="kpi-title">Total Contrats</div>
                                        <div class="kpi-value"><field name="total_contracts"/>.<span class="decimal">00</span></div>
                                    </div>
                                    <div class="kpi-badge">
                                        <i class="fa fa-ellipsis-v"></i>
                                    </div>
                                </div>
                                
                                <!-- Transferts (Interventions) -->
                                <div class="kpi-card bg-yellow">
                                    <div class="kpi-icon">
                                        <i class="fa fa-exchange-alt"></i>
                                    </div>
                                    <div class="kpi-info">
                                        <div class="kpi-title">Interventions</div>
                                        <div class="kpi-value"><field name="interventions_planned"/>.<span class="decimal">00</span></div>
                                    </div>
                                    <div class="kpi-badge">
                                        <i class="fa fa-ellipsis-v"></i>
                                    </div>
                                </div>
                                
                                <!-- Tickets -->
                                <div class="kpi-card bg-purple">
                                    <div class="kpi-icon">
                                        <i class="fa fa-ticket-alt"></i>
                                    </div>
                                    <div class="kpi-info">
                                        <div class="kpi-title">Total Tickets</div>
                                        <div class="kpi-value"><field name="tickets_open"/>.<span class="decimal">00</span></div>
                                    </div>
                                    <div class="kpi-badge">
                                        <i class="fa fa-ellipsis-v"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Cartes des alertes -->
                            <div class="alert-cards-container">
                                <!-- Garanties -->
                                <div class="alert-card bg-red">
                                    <div class="alert-icon">
                                        <i class="fa fa-shield-alt"></i>
                                    </div>
                                    <div class="alert-info">
                                        <div class="alert-title">Garanties à expiration</div>
                                        <div class="alert-value"><field name="expiring_warranties"/>.<span class="decimal">00</span></div>
                                    </div>
                                    <div class="alert-badge">
                                        <i class="fa fa-ellipsis-v"></i>
                                    </div>
                                </div>
                                
                                <!-- Licences -->
                                <div class="alert-card bg-pink">
                                    <div class="alert-icon">
                                        <i class="fa fa-file-alt"></i>
                                    </div>
                                    <div class="alert-info">
                                        <div class="alert-title">Licences à renouveler</div>
                                        <div class="alert-value"><field name="expiring_licenses"/>.<span class="decimal">00</span></div>
                                    </div>
                                    <div class="alert-badge">
                                        <i class="fa fa-ellipsis-v"></i>
                                    </div>
                                </div>
                                
                                <!-- Maintenance -->
                                <div class="alert-card bg-cyan">
                                    <div class="alert-icon">
                                        <i class="fa fa-tools"></i>
                                    </div>
                                    <div class="alert-info">
                                        <div class="alert-title">Maintenance planifiée</div>
                                        <div class="alert-value">10.<span class="decimal">00</span></div>
                                    </div>
                                    <div class="alert-badge">
                                        <i class="fa fa-ellipsis-v"></i>
                                    </div>
                                </div>
                                
                                <!-- Commandes -->
                                <div class="alert-card bg-violet">
                                    <div class="alert-icon">
                                        <i class="fa fa-shopping-cart"></i>
                                    </div>
                                    <div class="alert-info">
                                        <div class="alert-title">Commandes en attente</div>
                                        <div class="alert-value">1.<span class="decimal">07M</span></div>
                                    </div>
                                    <div class="alert-badge">
                                        <i class="fa fa-ellipsis-v"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Graphiques -->
                            <div class="charts-container">
                                <div class="chart-card">
                                    <div class="chart-header">
                                        <h4>Équipements</h4>
                                        <button class="btn-icon"><i class="fa fa-cog"></i></button>
                                    </div>
                                    <div class="chart-placeholder">
                                        <div class="pie-chart-placeholder"></div>
                                    </div>
                                </div>
                                
                                <div class="chart-card">
                                    <div class="chart-header">
                                        <h4>Contrats</h4>
                                        <button class="btn-icon"><i class="fa fa-cog"></i></button>
                                    </div>
                                    <div class="chart-placeholder">
                                        <div class="bar-chart-placeholder"></div>
                                    </div>
                                </div>
                                
                                <div class="chart-card">
                                    <div class="chart-header">
                                        <h4>Tickets</h4>
                                        <button class="btn-icon"><i class="fa fa-cog"></i></button>
                                    </div>
                                    <div class="chart-placeholder">
                                        <div class="pie-chart-placeholder colored"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- CSS personnalisé pour le tableau de bord -->
                            <style>
                                .modern-dashboard {
                                    font-family: 'Nunito', system-ui, -apple-system, sans-serif;
                                    background-color: #f9fafb;
                                    padding: 2rem;
                                    max-width: 1500px;
                                    margin: 0 auto;
                                }
                                
                                .action-bar {
                                    display: flex;
                                    gap: 10px;
                                    margin-bottom: 20px;
                                }
                                
                                .btn-modern {
                                    padding: 8px 16px;
                                    border-radius: 6px;
                                    font-weight: 600;
                                    font-size: 14px;
                                    border: none;
                                    cursor: pointer;
                                    transition: all 0.2s;
                                }
                                
                                .btn-primary {
                                    background-color: #4338ca;
                                    color: white;
                                }
                                
                                .btn-outline {
                                    background-color: transparent;
                                    color: #4338ca;
                                    border: 1px solid #d1d5db;
                                }
                                
                                .btn-icon {
                                    background: transparent;
                                    border: none;
                                    color: #6b7280;
                                    cursor: pointer;
                                }
                                
                                /* KPI cards styling */
                                .kpi-cards-container {
                                    display: grid;
                                    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                                    gap: 20px;
                                    margin-bottom: 20px;
                                }
                                
                                .kpi-card {
                                    display: flex;
                                    align-items: center;
                                    padding: 20px;
                                    border-radius: 16px;
                                    color: white;
                                    position: relative;
                                    overflow: hidden;
                                    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
                                }
                                
                                .kpi-icon {
                                    background: rgba(255, 255, 255, 0.2);
                                    width: 48px;
                                    height: 48px;
                                    border-radius: 12px;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    margin-right: 16px;
                                    font-size: 20px;
                                }
                                
                                .kpi-info {
                                    flex: 1;
                                }
                                
                                .kpi-title {
                                    font-weight: 600;
                                    opacity: 0.9;
                                    margin-bottom: 5px;
                                }
                                
                                .kpi-value {
                                    font-size: 22px;
                                    font-weight: 700;
                                }
                                
                                .decimal {
                                    font-size: 16px;
                                    opacity: 0.8;
                                }
                                
                                .kpi-badge {
                                    position: absolute;
                                    top: 15px;
                                    right: 15px;
                                    opacity: 0.5;
                                    cursor: pointer;
                                }
                                
                                /* Alert cards styling */
                                .alert-cards-container {
                                    display: grid;
                                    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                                    gap: 20px;
                                    margin-bottom: 20px;
                                }
                                
                                .alert-card {
                                    display: flex;
                                    align-items: center;
                                    padding: 16px;
                                    border-radius: 12px;
                                    color: white;
                                    position: relative;
                                    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
                                }
                                
                                .alert-icon {
                                    background: rgba(255, 255, 255, 0.2);
                                    width: 40px;
                                    height: 40px;
                                    border-radius: 10px;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    margin-right: 14px;
                                    font-size: 18px;
                                }
                                
                                .alert-info {
                                    flex: 1;
                                }
                                
                                .alert-title {
                                    font-weight: 500;
                                    opacity: 0.9;
                                    font-size: 14px;
                                    margin-bottom: 3px;
                                }
                                
                                .alert-value {
                                    font-size: 18px;
                                    font-weight: 700;
                                }
                                
                                .alert-badge {
                                    position: absolute;
                                    top: 12px;
                                    right: 12px;
                                    opacity: 0.5;
                                    cursor: pointer;
                                }
                                
                                /* Charts styling */
                                .charts-container {
                                    display: grid;
                                    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                                    gap: 20px;
                                    margin-bottom: 20px;
                                }
                                
                                .chart-card {
                                    background: white;
                                    border-radius: 12px;
                                    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
                                    padding: 16px;
                                    min-height: 250px;
                                }
                                
                                .chart-header {
                                    display: flex;
                                    justify-content: space-between;
                                    align-items: center;
                                    margin-bottom: 20px;
                                    padding-bottom: 10px;
                                    border-bottom: 1px solid #f3f4f6;
                                }
                                
                                .chart-header h4 {
                                    font-size: 16px;
                                    font-weight: 600;
                                    color: #374151;
                                    margin: 0;
                                }
                                
                                .chart-placeholder {
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    height: 180px;
                                }
                                
                                .pie-chart-placeholder {
                                    width: 150px;
                                    height: 150px;
                                    border-radius: 50%;
                                    background: conic-gradient(
                                        #4338ca 0% 25%, 
                                        #2dd4bf 25% 40%, 
                                        #f59e0b 40% 65%,
                                        #ef4444 65% 100%
                                    );
                                    position: relative;
                                }
                                
                                .pie-chart-placeholder::after {
                                    content: "";
                                    position: absolute;
                                    top: 50%;
                                    left: 50%;
                                    transform: translate(-50%, -50%);
                                    width: 70px;
                                    height: 70px;
                                    background: white;
                                    border-radius: 50%;
                                }
                                
                                .pie-chart-placeholder.colored {
                                    background: conic-gradient(
                                        #8b5cf6 0% 35%, 
                                        #ec4899 35% 55%, 
                                        #f97316 55% 80%,
                                        #10b981 80% 100%
                                    );
                                }
                                
                                .bar-chart-placeholder {
                                    width: 100%;
                                    height: 150px;
                                    display: flex;
                                    align-items: flex-end;
                                    justify-content: space-between;
                                    padding: 0 10px;
                                }
                                
                                .bar-chart-placeholder::before {
                                    content: "";
                                    position: absolute;
                                    width: 30px;
                                    height: 120px;
                                    background: #4338ca;
                                    border-radius: 5px 5px 0 0;
                                    margin-right: 175px;
                                }
                                
                                .bar-chart-placeholder::after {
                                    content: "";
                                    position: absolute;
                                    width: 30px;
                                    height: 80px;
                                    background: #f59e0b;
                                    border-radius: 5px 5px 0 0;
                                    margin-left: 175px;
                                }
                                
                                /* Background colors */
                                .bg-green { background: linear-gradient(to right, #047857, #10b981); }
                                .bg-blue { background: linear-gradient(to right, #2563eb, #3b82f6); }
                                .bg-yellow { background: linear-gradient(to right, #d97706, #f59e0b); }
                                .bg-purple { background: linear-gradient(to right, #6d28d9, #8b5cf6); }
                                .bg-red { background: linear-gradient(to right, #dc2626, #ef4444); }
                                .bg-pink { background: linear-gradient(to right, #db2777, #ec4899); }
                                .bg-cyan { background: linear-gradient(to right, #0e7490, #06b6d4); }
                                .bg-violet { background: linear-gradient(to right, #7c3aed, #8b5cf6); }
                            </style>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Vue Form pour le tableau de bord -->
    <record id="view_it_dashboard_form" model="ir.ui.view">
        <field name="name">it.dashboard.form</field>
        <field name="model">it.dashboard</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <div class="oe_title">
                        <h1>Tableau de bord IT</h1>
                    </div>
                    <notebook>
                        <!-- Les onglets seront ajoutés par héritage -->
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Action pour le tableau de bord -->
    <record id="action_it_parc_dashboard" model="ir.actions.act_window">
        <field name="name">Tableau de bord</field>
        <field name="res_model">it.dashboard</field>
        <field name="view_mode">kanban,form</field>
        <field name="view_id" ref="view_it_dashboard_kanban"/>
        <field name="target">main</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_neutral_face">
                Chargement du tableau de bord...
            </p>
        </field>
    </record>

    <!-- Ajouter au tableau de bord existant -->
    <record id="view_it_dashboard_form_alerts" model="ir.ui.view">
        <field name="name">it.dashboard.form.alerts</field>
        <field name="model">it.dashboard</field>
        <field name="inherit_id" ref="it_parc.view_it_dashboard_form"/>
        <field name="arch" type="xml">
            <!-- Ajouter une section pour les alertes -->
            <xpath expr="//notebook" position="inside">
                <page string="Alertes" name="alerts">
                    <div class="alert-summary">
                        <h3>Résumé des alertes</h3>
                        <div class="row mt16">
                            <div class="col-md-3">
                                <div class="card text-white bg-danger">
                                    <div class="card-body text-center">
                                        <h2 id="critical_alerts_count"/>
                                        <h4>Alertes critiques</h4>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card text-white bg-warning">
                                    <div class="card-body text-center">
                                        <h2 id="urgent_alerts_count"/>
                                        <h4>Alertes urgentes</h4>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card text-white bg-info">
                                    <div class="card-body text-center">
                                        <h2 id="pending_alerts_count"/>
                                        <h4>Alertes en attente</h4>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card text-white bg-success">
                                    <div class="card-body text-center">
                                        <h2 id="resolved_alerts_count"/>
                                        <h4>Alertes traitées</h4>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Dernières alertes critiques/urgentes -->
                    <div class="mt32">
                        <h3>Alertes nécessitant une attention immédiate</h3>
                        <div id="critical_alerts_list" class="table-responsive">
                            <!-- Rempli dynamiquement par JS -->
                        </div>
                    </div>
                    
                    <!-- Graphiques d'alertes -->
                    <div class="mt32 row">
                        <div class="col-md-6">
                            <h3>Répartition par type</h3>
                            <div id="alert_type_chart" style="height: 300px;"/>
                        </div>
                        <div class="col-md-6">
                            <h3>Statut des alertes</h3>
                            <div id="alert_state_chart" style="height: 300px;"/>
                        </div>
                    </div>
                </page>
            </xpath>
        </field>
    </record>
</odoo>
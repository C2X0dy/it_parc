<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Vue liste -->
    <record id="view_it_intervention_list" model="ir.ui.view">
        <field name="name">it.intervention.list</field>
        <field name="model">it.intervention</field>
        <field name="arch" type="xml">
            <list decoration-info="state == 'planned'" 
                  decoration-warning="state == 'in_progress'"
                  decoration-success="state == 'done'"
                  decoration-muted="state == 'cancelled'">
                <field name="name"/>
                <field name="date_start"/>
                <field name="date_end"/>
                <field name="partner_id"/>
                <field name="technician_id"/>
                <field name="type"/>
                <field name="priority" widget="priority"/>
                <field name="state"/>
            </list>
        </field>
    </record>
    
    <!-- Vue formulaire - ajustée pour Odoo 18.0 -->
    <record id="view_it_intervention_form" model="ir.ui.view">
        <field name="name">it.intervention.form</field>
        <field name="model">it.intervention</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button name="action_start" string="Démarrer" type="object" 
                            class="oe_highlight" invisible="state != 'planned'"/>
                    <button name="action_done" string="Terminer" type="object" 
                            class="oe_highlight" invisible="state != 'in_progress'"/>
                    <button name="action_cancel" string="Annuler" type="object" 
                            invisible="state in ['done', 'cancelled']"/>
                    <button name="action_plan" string="Replanifier" type="object" 
                            invisible="state != 'cancelled'"/>
                    <field name="state" widget="statusbar"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="name"/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="partner_id"/>
                            <field name="technician_id" options="{'no_create': True}"/>
                            <field name="type"/>
                            <field name="priority" widget="priority"/>
                            <field name="ticket_id"/>
                        </group>
                        <group>
                            <field name="date_start"/>
                            <field name="date_end"/>
                            <field name="duration" widget="float_time"/>
                            <field name="contract_id"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Description">
                            <field name="description" placeholder="Détails de l'intervention prévue..."/>
                        </page>
                        <page string="Équipements concernés">
                            <field name="asset_ids"/>
                        </page>
                        <page string="Matériel utilisé">
                            <field name="material_line_ids"/>
                        </page>
                        <page string="Rapport d'intervention" invisible="state not in ['done']">
                            <group>
                                <field name="materials_used" placeholder="Matériel et pièces utilisés"/>
                            </group>
                            <field name="report" placeholder="Rapport détaillé de l'intervention"/>
                            <group>
                                <field name="signature" widget="signature"/>
                                <field name="signature_name" placeholder="Nom du signataire"/>
                                <field name="signature_date"/>
                            </group>
                        </page>
                        <page string="Notes">
                            <field name="notes" placeholder="Notes et commentaires..."/>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>
    
    <!-- Vue pour les lignes de matériel - ajustée pour Odoo 18.0 -->
    <record id="view_it_intervention_material_tree" model="ir.ui.view">
        <field name="name">it.intervention.material.tree</field>
        <field name="model">it.intervention.material</field>
        <field name="arch" type="xml">
            <!-- Changement de tree à list -->
            <list editable="bottom">
                <field name="product_id"/>
                <field name="quantity"/>
                <field name="unit_price"/>
                <field name="total_price"/>
                <field name="stock_available"/>
                <field name="stock_location_id" optional="hide"/>
                <field name="state"/>
                <button name="action_allocate_stock" string="Allouer" type="object" 
                        class="oe_highlight" 
                        invisible="state != 'draft' or stock_available &lt; quantity"/>
                <button name="action_request_purchase" string="Achat" type="object"
                        class="btn-warning"
                        invisible="state != 'draft' or stock_available &gt;= quantity"/>
            </list>
        </field>
    </record>
    
    <!-- Vue calendrier -->
    <record id="view_it_intervention_calendar" model="ir.ui.view">
        <field name="name">it.intervention.calendar</field>
        <field name="model">it.intervention</field>
        <field name="arch" type="xml">
            <calendar date_start="date_start" date_stop="date_end">
                <field name="name"/>
                <field name="partner_id"/>
            </calendar>
        </field>
    </record>
    
    <!-- Action -->
    <record id="action_it_intervention" model="ir.actions.act_window">
        <field name="name">Interventions</field>
        <field name="res_model">it.intervention</field>
        <field name="view_mode">calendar,list,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Planifiez votre première intervention technique !
            </p>
        </field>
    </record>
    
    <!-- Action Planning des techniciens -->
    <record id="action_it_technician_planning" model="ir.actions.act_window">
        <field name="name">Planning des techniciens</field>
        <field name="res_model">it.intervention</field>
        <field name="view_mode">calendar,list</field>
        <field name="view_id" ref="view_it_intervention_calendar"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Le planning des techniciens est vide
            </p>
        </field>
    </record>
</odoo>